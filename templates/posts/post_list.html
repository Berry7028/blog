{% extends "base.html" %}

{% block title %}Posts | Blog{% endblock %}

{% block content %}
  <div class="layout">
    <section class="main">
      <div class="page-row">
        <h1 class="page-title">
          {% if active_category %}カテゴリ: {{ active_category.name }}
          {% elif active_tag %}タグ: {{ active_tag.name }}
          {% else %}投稿一覧{% endif %}
        </h1>
        {% if user.is_authenticated %}
          <a class="btn" href="{% url 'posts:post_create' %}">新規投稿</a>
        {% endif %}
      </div>

      {% for post in posts %}
        <article class="card">
          {% if post.image %}
            <div class="card-image">
              <a href="{{ post.get_absolute_url }}">
                <img src="{{ post.image.url }}" alt="{{ post.title }}" style="width: 100%; height: auto; max-height: 300px; object-fit: cover; border-radius: 4px 4px 0 0;">
              </a>
            </div>
          {% endif %}
          <h2 class="card-title">
            <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
          </h2>
          <div class="meta">
            {% if post.published_at %}<span>{{ post.published_at|date:"Y-m-d H:i" }}</span>{% endif %}
            {% if post.category %}
              <span>· <a href="{{ post.category.get_absolute_url }}">{{ post.category.name }}</a></span>
            {% endif %}
          </div>
          {% if post.excerpt %}
            <p class="excerpt">{{ post.excerpt }}</p>
          {% endif %}
          <div class="tags">
            {% for tag in post.tags.all %}
              <a class="tag" href="{{ tag.get_absolute_url }}">#{{ tag.name }}</a>
            {% endfor %}
          </div>
        </article>
      {% empty %}
        <p>まだ投稿がありません。</p>
      {% endfor %}

      {% include "partials/pagination.html" %}
    </section>

    <aside class="sidebar">
      <div class="panel">
        <h3>カテゴリ</h3>
        <ul>
          {% for c in categories %}
            <li>
              <a href="{{ c.get_absolute_url }}">{{ c.name }}</a>
            </li>
          {% empty %}
            <li>なし</li>
          {% endfor %}
        </ul>
      </div>

      <div class="panel">
        <h3>タグ</h3>
        <div class="tags">
          {% for t in tags %}
            <a class="tag" href="{{ t.get_absolute_url }}">#{{ t.name }}</a>
          {% empty %}
            <span>なし</span>
          {% endfor %}
        </div>
      </div>
    </aside>
  </div>
{% endblock %}
